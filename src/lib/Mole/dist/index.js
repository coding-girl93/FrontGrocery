setTimeout(function(){!window.Mole&&(window.Mole={}),Mole.performance=Mole.performance||{},Mole.performance.firstScreenTime=Mole.performance.firstScreenTime||function(){},Mole.performance.custom=Mole.performance.custom||function(){},Mole.log=Mole.log||{},Mole.log.debug=Mole.log.debug||function(){},Mole.log.error=Mole.log.error||function(){},Mole.init=Mole.init||function(){}},0);var jsMoleStartTime=(new Date).getTime();if(-1===window.location.href.indexOf("/fx")||-1===window.location.href.indexOf("weidian.com/item.html")||10*Math.random()<=3||window.location.href.indexOf("debug")>-1)try{!function(){var e=function(e){this.pending=[],this.value="",setTimeout(function(){e(this.resolve.bind(this),this.reject.bind(this))}.bind(this))};e.prototype.resolve=function(e){this.value=this.pending[0][0](e),this.doPending()},e.prototype.reject=function(e){this.value=this.pending[0][1](e),this.doPending()},e.prototype.doPending=function(){for(var e=1;e<this.pending.length;e++){var t=this.pending[e][0];this.value=t(this.value)}},e.prototype.then=function(e,t){return this.pending.push([e,t]),this},window.MolePromise=e}(),function(e){var t=navigator.userAgent;window.Mole={};var n={online:"//vap.gw.weidian.com/h5/mole/perf.collect/2.0",pre:"//vap.gw.pre.weidian.com/h5/mole/perf.collect/1.0",daily:"//vap.gw.daily.weidian.com/h5/mole/perf.collect/2.0"},i=["//h5.weidian.com","//weidian.com","//www.weidian.com","//fxh5.weidian.com"];Mole.init=function(e){try{o.delay=e.delay||o.delay,o.RT=e.RT||o.RT,o.spma=e.spma||o.spma,o.spmb=e.spmb||o.spmb,o.version=e.version||o.version,o.id=e.id||o.id}catch(t){}},e.MoleReg=function(e,t){Mole[t]=new e(o)};var r=function(){for(var e=[],t="0123456789abcdef",n=0;36>n;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var i=e.join("");return i},o={id:r(),version:"unknow",env:/pre/.test(window.location.hostname)?"pre":"daily",delay:2e3,RT:5e3,spma:"",spmb:""};i.forEach(function(e){("//"+window.location.hostname).indexOf(e)>-1&&(o.env="online")}),o.vap=n,o.push=function(e,t){clearTimeout(this._timeout),a._reportData=a._reportData||[],a._reportData.push(e);var n=this.delay;t?a._send():this._timeout=setTimeout(function(){a._send()},n)};var a={};/debug/.test(window.location.search)&&(document.title=o.id),a._setSpm=function(){if(!o.spma){var e=document.querySelector('meta[name="spider-id"]');if(o.spma=e?e.getAttribute("content"):"",!o.spma)return alert("必须设置spma"),!1}o.spmb||(o.spmb=(document.body?document.body.dataset.spider:"")||""),o.spmb||(o.spmb=window.location.pathname),o.id=[o.spmb.substr(0,10),o.id].join("-")},a._reset=function(){this._reportData=[]},a._send=function(){var e=this;if(!this._reportData||!this._reportData.length)return!1;var t=n[o.env]||n.daily;new MolePromise(this._getData.bind(this)).then(function(n){e._ajax({type:"POST",url:t+"?id="+o.id,data:"meta="+encodeURIComponent(JSON.stringify(n)),success:function(e){}}),e._reset()})},a._getNetType=function(e){var n=t.match(/NetType\/([^\s]+)/i),i="";n&&n[1]&&(i=n[1].toUpperCase()),n&&i&&("WIFI"===i||"4G"===i||"3G"===i||"2G"===i||"4.5G"===i||"5G"===i)?e(i):/MicroMessenger/i.test(t)?new MolePromise(this._getWxNetType).then(function(t){e(t)}):/WDAPP/i.test(t)&&window.Cambridge?Cambridge.call("WDJSBridge","getNetworkStatus",{},function(t){var n={2:"wifi",3:"2g",4:"3g",5:"4g"};if(t&&t.data&&t.data.network){var i=t.data.network;e(n[i]||"")}else e("")}):e("")},a._getWxNetType=function(e,t){window.wx&&wx.getNetworkType?wx.getNetworkType({success:function(t){var n=t.networkType;e(n)},fail:function(){e("")}}):e("")},a._formart=function(e){Object.keys(e).forEach(function(t){isNaN(e[t])||"ns"===t||(e[t]=parseInt(e[t]),0===e[t]?e[t]="zero":e.ns&&e[t]>99999999&&(e[t]=e[t]-e.ns))})},a._getData=function(e){if(!(o.spma&&o.spmb||(this._setSpm(),o.spma&&o.spmb)))return this._reportData=[],alert("没有设置spm值"),!1;var n=this._dataCloumnMap(this._reportData),i={id:o.id,spma:o.spma,spmb:o.spmb,version:o.version,ua:t,url:window.location.href,referrer:document.referrer,nt:"",data:n};new MolePromise(this._getNetType.bind(this)).then(function(t){i.nt=t?t.toUpperCase():"",e(i)})},a._dataCloumnMap=function(e){var t=this,n={navigationStart:"ns",unloadEventStart:"ues",unloadEventEnd:"uee",redirectStart:"rs",redirectEnd:"re",fetchStart:"fs",domainLookupStart:"dls",domainLookupEnd:"dle",connectStart:"cs",connectEnd:"ce",secureConnectionStart:"scs",requestStart:"rqs",responseStart:"rps",responseEnd:"rpe",domLoading:"dl",domInteractive:"di",domContentLoadedEventStart:"dcles",domContentLoadedEventEnd:"dclee",domComplete:"dc",loadEventStart:"les",loadEventEnd:"lee",firstScreenCost:"fcs",perfType:"pt",duration:"dur",entryType:"et",startTime:"st",workerStart:"ws",initiatorType:"rt"},i=[];return e.forEach(function(e){var r={};Object.keys(e).forEach(function(t){var i=n[t]||t;r[i]=e[t]}),t._formart(r),i.push(r)}),i},a._ajax=function(e){var t=new window.XMLHttpRequest;return t.withCredentials=!0,t.onreadystatechange=function(){if(4==t.readyState){t.onreadystatechange=function(){};var n,i=!1;if(t.status>=200&&t.status<300){n=t.responseText;try{n=JSON.parse(n)}catch(r){i=r}!i&&e&&e.success&&e.success(n,t)}}},t.open(e.type,e.url,!0),t.setRequestHeader("Accept","application/json, text/plain, */*"),t.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),t.send(e.data?e.data:null),t}}(window),function(){var e={};e.timing=window.performance&&window.performance.timing,e.resourceTiming=window.performance&&window.performance.getEntries;var t=0,n=function(e){var t={};for(var n in e)"function"!=typeof e[n]&&(t[n]=e[n]);return t},i=function(e){for(var t=e.offsetTop,n=e.offsetParent;null!==n;)t+=n.offsetTop,n=n.offsetParent;return t},r=function(e){this._cxt=e},o=r.prototype,a=[];o._push=function(e){this._cxt.push(e)},o.firstScreenTime=function(n,i){if(!e.timing)return!1;try{i&&i.length&&(a=a.concat(i)),this._firstScreenTimes=this._firstScreenTimes||0,this._firstScreenTimes++,this._firstScreenTimes===n&&(t=(new Date).getTime(),this._firstScreenTimeSrouce(a))}catch(r){}},o._setFirstScreenTime=function(){var i=(new Date).getTime(),r=e.timing;r=n(r),r.perfType="firstScreen",r.type="performance";var o=i-e.timing.navigationStart;r.firstScreenCost=o,window.location.search.indexOf("debug")>-1&&console.log(o),Mole.performance.custom("moleJsFirstScreen",(new Date).getTime()-t),this._cxt.push(r)},o._getResouce=function(){var e=window.innerHeight,t=[];if(window.location.href.indexOf("m/fxbuyer/item.html")>-1)var n=document.querySelectorAll(".mole-bg");else n=document.querySelectorAll("body img,.mole-bg");for(var r=0;r<n.length;r++){var o=n[r],a=i(o);if(a+o.offsetHeight>=document.body.scrollTop&&a<=e+document.body.scrollTop){if("img"===o.tagName.toLowerCase()){var s=o.getAttribute("src"),c=o.getAttribute("data-src")||o.getAttribute("data-echo");c&&(s=c)}else{var f=getComputedStyle(o)["background-image"];s=f.replace(/url\([\'\"]{0,1}/,"").replace(/['"]{0,1}\)/,"")}s&&-1===s.indexOf("url(")&&-1===s.indexOf("data:")&&/\.(jpg|gif|png|jpeg|webp)/i.test(s)&&t.push(s)}}return t},o._firstScreenTimeSrouce=function(e){var t=this,n=this._getResouce();if(!n.length&&!e.length)return this._setFirstScreenTime(),!0;var i=0,r=function(){i++,i===n.length+e.length&&(window.location.search.indexOf("debug")>-1&&(console.log(n),console.log(e)),t._setFirstScreenTime(),t._getFirstResouce(e.concat(n)))};e.concat(n).forEach(function(e){var n=new Image;t._imgOnload(n,r),n.src=e})},o._imgOnload=function(e,t){e.onload=t,e.onerror=t},o._getFirstResouce=function(t){if(!e.resourceTiming)return!1;var n=this,i=window.performance.getEntries({entryType:"resource"});i=i.map(function(e){var t=e.name;if(0===t.indexOf(window.location.href))return"";if(-1===t.indexOf("??")&&(t=t.replace(/\?.+/,"")),-1===t.indexOf("assets.geilicdn.com")&&-1===t.indexOf("si.geilicdn.com")&&-1===t.indexOf("wd.geilicdn.com"))return{name:t||"no-name",initiatorType:e.initiatorType,entryType:e.entryType,startTime:e.startTime,duration:e.duration,perfType:"resourceTiming",type:"performance"};var n={perfType:"resourceTiming",type:"performance"},i=function(e){return Object.prototype.toString.call(e)};for(var r in e)"[object String]"!==i(e[r])&&"[object Number]"!==i(e[r])||(n[r]=e[r]);return n.name=t,n}),i=i.filter(function(e){if(!e)return!1;if(e.startTime<=0)return!1;if(e.duration<=0)return!1;var n=e.name.replace("http://","").replace("https://","");if(n.indexOf("analysis")>-1)return!1;if(!/\.(jpg|gif|png|jpeg|webp)/i.test(n))return!0;var i=!1;return t.forEach(function(e){e.indexOf(n)>-1&&(i=!0)}),i}),i.map(function(e){n._push(e)})},MoleReg(r,"firstScreen")}(),function(){function e(e){this._cxt=e}var t={};t.timing=window.performance&&window.performance.timing;var n=e.prototype;n._push=function(e){this._cxt.push(e)},n.custom=function(e,n){if(!t.timing)return!1;try{if(!e)return!1;n=n||0;var i=(new Date).getTime()-t.timing.navigationStart;this._push({name:e,startTime:i-n,duration:n||0,perfType:"custom",type:"performance"})}catch(r){}},n.firstScreenTime=function(e,t){Mole.firstScreen.firstScreenTime(e,t)},MoleReg(e,"performance")}()}catch(e){console.log(e)}var jsMoleEndTime=(new Date).getTime();Mole.performance.custom("molejs",jsMoleEndTime-jsMoleStartTime);